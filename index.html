<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marginal effects for a wide variety of models • marginaleffects</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Marginal effects for a wide variety of models">
<meta property="og:description" content='Compute, summarize, and plot "marginal effects" for a wide variety of models. The package uses automatic differentiation to compute marginal effects for numeric regressors (partial derivatives of the regression equation), and calculates adjusted contrasts for categorical regressors.'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">marginaleffects</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="articles/mfx.html">Marginal effects</a>
</li>
<li>
  <a href="articles/marginalmeans.html">Marginal means</a>
</li>
<li>
  <a href="articles/contrasts.html">Contrasts</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="the-marginaleffects-package-for-r" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#the-marginaleffects-package-for-r" class="anchor"></a>The <code>marginaleffects</code> package for <code>R</code>
</h1></div>
<!-- badges: start -->

<p>This package is still experimental. <em>Use with caution!</em></p>
<div id="what" class="section level2">
<h2 class="hasAnchor">
<a href="#what" class="anchor"></a>What?</h2>
<p>The <code>marginaleffects</code> package allows <code>R</code> users to compute and plot three principal quantities of interest for a <em>wide</em> variety of models:</p>
<ul>
<li>
<a href="https://vincentarelbundock.github.io/marginaleffects/articles/mfx.html"><em>Marginal Effect</em> (Vignette)</a>
<ul>
<li>A partial derivative (slope) of the regression equation with respect to a regressor of interest.</li>
</ul>
</li>
<li>
<a href="https://vincentarelbundock.github.io/marginaleffects/articles/marginalmeans.html"><em>Marginal Mean</em> (Vignette)</a>
<ul>
<li>Response predicted by a model for some combination of the regressors’ values (a.k.a. “reference grid”), typically their means or factor levels.</li>
</ul>
</li>
<li>
<a href="https://vincentarelbundock.github.io/marginaleffects/articles/contrasts.html"><em>Contrast</em> (Vignette)</a>
<ul>
<li>The difference between two Marginal Means, calculated for meanginfully different regressor values (e.g., College graduates vs. Others).</li>
</ul>
</li>
</ul>
</div>
<div id="why" class="section level2">
<h2 class="hasAnchor">
<a href="#why" class="anchor"></a>Why?</h2>
<p>To calculate marginal effects we need to take derivatives of the regression equation. This can be challenging to do manually, especially when our models are non-linear, or when regressors are transformed or interacted. Computing the variance of a marginal effect is even more difficult.</p>
<p>The <code>marginaleffects</code> package hopes to do most of this hard work for you.</p>
<p>Many <code>R</code> packages advertise their ability to compute “marginal effects.” However, most of them do <em>not</em> actually compute marginal effects <em>as defined above</em>. Instead, they compute fitted values for different predictor values (i.e., “Marginal Means”), or differences in fitted values (i.e., “contrasts”). The rare packages that actually compute marginal effects are typically limited in the model types they support, and in the range of transformations they allow (interactions, polynomials, etc.).</p>
<p>The main package in the <code>R</code> ecosystem to compute marginal effects is <a href="https://cran.r-project.org/web/packages/margins/index.html">the fantastic, trailblazing, and powerful <code>margins</code></a> by <a href="https://thomasleeper.com/">Thomas J. Leeper.</a> The <code>marginaleffects</code> package is (essentially) a clone of Leeper’s <code>margins</code> and <code>prediction</code> packages.</p>
<p>So why did I write a clone?</p>
<ul>
<li>
<em>Speed:</em> <a href="https://vincentarelbundock.github.io/marginaleffects/articles/benchmark.html">In one benchmark,</a> computing unit-level standard errors is over 400x faster with <code>marginaleffects</code> (minutes vs. milliseconds).</li>
<li>
<em>Efficiency:</em> Smaller memory footprint (1.8GB vs 52MB in the same example).</li>
<li>
<em>Extensibility:</em> Adding support for new models is very easy, often requiring less than 10 lines of new code. In the medium run, the goal is to add support for <em>several</em> more model types.</li>
<li>
<code>ggplot2</code> support for plotting (conditional) marginal effects.</li>
<li>
<em>Tidy:</em> The results produced by <code>marginaleffects</code> follow “tidy” principles. They are easy to process and program with.</li>
<li>
<em>User interface:</em> Related functions are incorporated in a simple, unified, and well-documented interface.</li>
<li>
<em>Safe:</em> User input is checked extensively before computation. When needed, functions fail gracefully with informative error messages.</li>
<li><em>Active development</em></li>
</ul>
<p>Downsides of <code>marginaleffects</code> include:</p>
<ul>
<li>Weights and simultation-based inference are not (yet) supported.</li>
<li>More dependencies.</li>
<li>Newer package with a smaller (read: nonexistent) user base.</li>
</ul>
</div>
<div id="how" class="section level2">
<h2 class="hasAnchor">
<a href="#how" class="anchor"></a>How?</h2>
<p>By using <a href="https://cran.r-project.org/web/packages/numDeriv/index.html">the <code>numDeriv</code> package</a> to compute gradients and jacobians, and <a href="https://easystats.github.io/insight/">the <code>insight</code> package</a> to extract information from model objects. That’s it. That’s the secret sauce.</p>
</div>
<div id="supported-models" class="section level2">
<h2 class="hasAnchor">
<a href="#supported-models" class="anchor"></a>Supported models</h2>
<p>This table shows the list of models supported by <code>marginaleffect</code>, and shows which numerical results have been checked against alternative software packages: Stata’s <code>margins</code> command and R’s <code>margins</code> package.</p>
<p>I am <em>very</em> eager to add support for new models. Feel free to file a request on Github or – even better – submit some code.</p>
<p>Warning: When using <code>marginaleffects</code> with different models, you will probably have to adjust the <code>predict_type</code> argument. Refer to the documentation of your modeling package to see what <code>type</code> argument is allowed in the <code>predict</code> function.</p>
<table class="table">
<thead><tr class="header">
<th align="left">Model</th>
<th align="left">Support: Effect</th>
<th align="left">Support: Std. Errors</th>
<th align="left">Validity: Stata</th>
<th align="left">Validity: Margins</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">stats::lm</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left">x</td>
</tr>
<tr class="even">
<td align="left">stats::glm</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left">x</td>
</tr>
<tr class="odd">
<td align="left">aer::ivreg</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left">x</td>
</tr>
<tr class="even">
<td align="left">aer::tobit</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">betareg::betareg</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left">x</td>
</tr>
<tr class="even">
<td align="left">bife::bife</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">brglm2::brglmFit</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">brglm2::brnb</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">estimatr::lm_robust</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">fixest::feols</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">fixest::feglm</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">gam::gam</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">geepack::geeglm</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">glmx::glmx</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">ivreg::ivreg</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left">x</td>
</tr>
<tr class="even">
<td align="left">lme4::lmer</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left">dydx only</td>
</tr>
<tr class="odd">
<td align="left">lme4::glmer</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left">dydx only</td>
</tr>
<tr class="even">
<td align="left">MASS::glm.nb</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left">x</td>
</tr>
<tr class="odd">
<td align="left">MASS::polr</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left">x</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">MASS::rlm</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">nlme::gls</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">ordinal::clm</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">x</td>
</tr>
<tr class="odd">
<td align="left">plm::plm</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">pscl::hurdle</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">pscl::zeroinfl</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">rms::lrm</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">robustbase::glmrob</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">robustbase::lmrob</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">speedglm::speedglm</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">speedglm::speedlm</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">survey::svyglm</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left">x</td>
</tr>
<tr class="even">
<td align="left">survival::coxph</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">truncreg::truncreg</td>
<td align="left">x</td>
<td align="left">x</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install the latest version of <code>marginaleffects</code> from Github:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"vincentarelbundock/marginaleffects"</span><span class="op">)</span></code></pre></div>
</div>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h2>
<p>First, we load the library, download the <a href="https://allisonhorst.github.io/palmerpenguins/">Palmer Penguins</a> data from the <a href="https://vincentarelbundock.github.io/Rdatasets/articles/data.html"><code>Rdatasets</code> archive</a>, and estimate a GLM model:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/marginaleffects/">marginaleffects</a></span><span class="op">)</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"https://vincentarelbundock.github.io/Rdatasets/csv/palmerpenguins/penguins.csv"</span><span class="op">)</span>
<span class="va">dat</span><span class="op">$</span><span class="va">large_penguin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">body_mass_g</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">body_mass_g</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>

<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">large_penguin</span> <span class="op">~</span> <span class="va">bill_length_mm</span> <span class="op">+</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">species</span>, 
           data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></code></pre></div>
<p>A “marginal effect” is a unit-specific measure of association between a change in a regressor and a change in the regressand. In most cases, its value will depend on the values of all the other variables in the model for that specific unit.</p>
<p>The <code>marginaleffects</code> function thus computes a distinct estimate of the marginal effect and of the standard error for each regressor (“term”), for each unit of observation (“rowid”). You can view and manipulate the full results with functions like <code>head</code>, as you would with any other <code>data.frame</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mfx</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/marginaleffects.html">marginaleffects</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mfx</span><span class="op">)</span>
<span class="co">#&gt;   rowid     type           term       dydx   std.error large_penguin</span>
<span class="co">#&gt; 1     1 response bill_length_mm 0.01762275 0.007837288             0</span>
<span class="co">#&gt; 2     2 response bill_length_mm 0.03584665 0.011917159             0</span>
<span class="co">#&gt; 3     3 response bill_length_mm 0.08443344 0.021119186             0</span>
<span class="co">#&gt; 4     4 response bill_length_mm 0.03471401 0.006506804             0</span>
<span class="co">#&gt; 5     5 response bill_length_mm 0.05087500 0.013407802             0</span>
<span class="co">#&gt; 6     6 response bill_length_mm 0.01650827 0.007252823             0</span>
<span class="co">#&gt;   bill_length_mm flipper_length_mm species  predicted</span>
<span class="co">#&gt; 1           39.1               181  Adelie 0.05123266</span>
<span class="co">#&gt; 2           39.5               186  Adelie 0.11125087</span>
<span class="co">#&gt; 3           40.3               195  Adelie 0.36919834</span>
<span class="co">#&gt; 4           36.7               193  Adelie 0.10725326</span>
<span class="co">#&gt; 5           39.3               190  Adelie 0.16882994</span>
<span class="co">#&gt; 6           38.9               181  Adelie 0.04782069</span></code></pre></div>
<p>Notice that the results are presented in “tidy” long format: each row of the original dataset gets a unique <code>rowid</code> value, each unit-level marginal effect appears on a distinct row, and metadata appears neatly in separate columns. This makes it easy to operate on the results programmatically.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Browse source code at <br><a href="https://github.com/vincentarelbundock/marginaleffects/">https://​github.com/​vincentarelbundock/​marginaleffects/​</a>
</li>
<li>Report a bug at <br><a href="https://github.com/vincentarelbundock/marginaleffects/issues">https://​github.com/​vincentarelbundock/​marginaleffects/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>GPL (&gt;= 3)</small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Vincent Arel-Bundock <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-2042-7063" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.tidyverse.org/lifecycle/#experimental"><img src="https://img.shields.io/badge/lifecycle-experimental-orange.svg" alt="Lifecycle: experimental"></a></li>
<li><a href="https://codecov.io/gh/vincentarelbundock/marginaleffects?branch=main"><img src="https://codecov.io/gh/vincentarelbundock/marginaleffects/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://github.com/vincentarelbundock/marginaleffects/actions"><img src="https://github.com/vincentarelbundock/marginaleffects/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Vincent Arel-Bundock.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
