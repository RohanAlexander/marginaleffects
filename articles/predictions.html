<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="marginaleffects">
<title>Adjusted Predictions • marginaleffects</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Adjusted Predictions">
<meta property="og:description" content="marginaleffects">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-default navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">marginaleffects</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.1.9111</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="https://vincentarelbundock.github.io/marginaleffects/articles/predictions.html">Predictions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://vincentarelbundock.github.io/marginaleffects/articles/slopes.html">Slopes</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://vincentarelbundock.github.io/marginaleffects/articles/contrasts.html">Comparisons</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://vincentarelbundock.github.io/marginaleffects/articles/marginalmeans.html">Marginal means</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="https://vincentarelbundock.github.io/marginaleffects/articles/hypothesis.html">Hypothesis tests</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/vincentarelbundock/marginaleffects/">
    <span class="fab fa fab fa-github"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="predictions_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="predictions_files/kePrint-0.0.1/kePrint.js"></script><link href="predictions_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Adjusted Predictions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/vincentarelbundock/marginaleffects/blob/HEAD/vignettes/predictions.Rmd" class="external-link"><code>vignettes/predictions.Rmd</code></a></small>
      <div class="d-none name"><code>predictions.Rmd</code></div>
    </div>

    
    
<p>In the context of this package, an “Adjusted Prediction” is defined as:</p>
<blockquote>
<p>The outcome predicted by a fitted model on a specified scale for a given combination of values of the predictor variables, such as their observed values, their means, or factor levels (a.k.a. “reference grid”).</p>
</blockquote>
<p>Here, the word “Adjusted” simply means “model-derived” or “model-based.”</p>
<div class="section level2">
<h2 id="prediction-type-or-scale">Prediction type (or scale)<a class="anchor" aria-label="anchor" href="#prediction-type-or-scale"></a>
</h2>
<p>Using the <code>type</code> argument of the <code><a href="../reference/predictions.html">predictions()</a></code> function we can specify the “scale” on which to make predictions. This refers to either the scale used to estimate the model (i.e., link scale) or to a more interpretable scale (e.g., response scale). For example, when fitting a linear regression model using the <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> function, the link scale and the response scale are identical. An “Adjusted Prediction” computed on either scale will be expressed as the mean value of the response variable at the given values of the predictor variables.</p>
<p>On the other hand, when fitting a binary logistic regression model using the <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> function (which uses a binomial family and a logit link ), the link scale and the response scale will be different: an “Adjusted Prediction” computed on the link scale will be expressed as a log odds of a “successful” response at the given values of the predictor variables, whereas an “Adjusted Prediction” computed on the response scale will be expressed as a probability that the response variable equals 1.</p>
<p>The default value of the <code>type</code> argument for most models is “response”, which means that the <code><a href="../reference/predictions.html">predictions()</a></code> function will compute predicted probabilities (binomial family), Poisson means (poisson family), etc.</p>
</div>
<div class="section level2">
<h2 id="prediction-grid">Prediction grid<a class="anchor" aria-label="anchor" href="#prediction-grid"></a>
</h2>
<p>To compute adjusted predictions we must first specify the values of the predictors to consider: a “reference grid.” For example, if our model is a linear model fitted with the lm() function which relates the response variable Happiness with the predictor variables Age, Gender and Income, the reference grid could be a <code>data.frame</code> with values for Age, Gender and Income: Age = 40, Gender = Male, Income = 60000.</p>
<p>The “reference grid” may or may not correspond to actual observations in the dataset used to fit the model; the example values given above could match the mean values of each variable, or they could represent a specific observed (or hypothetical) individual. The reference grid can include many different rows if we want to make predictions for different combinations of predictors. By default, the <code><a href="../reference/predictions.html">predictions()</a></code> function uses the full original dataset as a reference grid, which means it will compute adjusted predictions for each of the individuals observed in the dataset that was used to fit the model.</p>
</div>
<div class="section level2">
<h2 id="the-predictions-function">The <code>predictions()</code> function<a class="anchor" aria-label="anchor" href="#the-predictions-function"></a>
</h2>
<p>By default, <code>predictions</code> calculates the regression-adjusted predicted values for every observation in the original dataset:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vincentarelbundock.github.io/marginaleffects/">marginaleffects</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rowid     type estimate std.error statistic       p.value conf.low conf.high  mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span><span class="co">#&gt; 1     1 response 20.03819 1.2041405  16.64107  3.512623e-62 17.67812  22.39826 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></span>
<span><span class="co">#&gt; 2     2 response 20.03819 1.2041405  16.64107  3.512623e-62 17.67812  22.39826 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></span>
<span><span class="co">#&gt; 3     3 response 26.41451 0.9619738  27.45866 5.476301e-166 24.52907  28.29994 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></span>
<span><span class="co">#&gt; 4     4 response 20.03819 1.2041405  16.64107  3.512623e-62 17.67812  22.39826 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></span>
<span><span class="co">#&gt; 5     5 response 15.92247 0.9924560  16.04350  6.347069e-58 13.97729  17.86765 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></span>
<span><span class="co">#&gt; 6     6 response 20.15839 1.2186288  16.54186  1.832792e-61 17.76992  22.54685 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></span></code></pre></div>
<p>In many cases, this is too limiting, and researchers will want to specify a grid of “typical” values over which to compute adjusted predictions.</p>
</div>
<div class="section level2">
<h2 id="adjusted-predictions-at-user-specified-values-aka-adjusted-predictions-at-representative-values-apr">Adjusted Predictions at User-Specified values (aka Adjusted Predictions at Representative values, APR)<a class="anchor" aria-label="anchor" href="#adjusted-predictions-at-user-specified-values-aka-adjusted-predictions-at-representative-values-apr"></a>
</h2>
<p>There are two main ways to select the reference grid over which we want to compute adjusted predictions. The first is using the <code>variables</code> argument. The second is with the <code>newdata</code> argument and the <a href="https://vincentarelbundock.github.io/marginaleffects/reference/datagrid.html"><code>datagrid()</code> function</a> that we already introduced in the <a href="https://vincentarelbundock.github.io/marginaleffects/articles/slopes.html">marginal effects vignette.</a></p>
<div class="section level3">
<h3 id="variables-counterfactual-predictions">
<code>variables</code>: Counterfactual predictions<a class="anchor" aria-label="anchor" href="#variables-counterfactual-predictions"></a>
</h3>
<p>The <code>variables</code> argument is a handy way to create and make predictions on counterfactual datasets. For example, here the dataset that we used to fit the model has 32 rows. The counterfactual dataset with two distinct values of <code>hp</code> has 64 rows: each of the original rows appears twice, that is, once with each of the values that we specified in the <code>variables</code> argument:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>hp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">120</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rowid rowidcf     type estimate std.error statistic       p.value conf.low conf.high  mpg cyl  hp</span></span>
<span><span class="co">#&gt; 1     1       1 response 20.27858 1.2377512 16.383405  2.512745e-60 17.85263  22.70453 21.0   6 100</span></span>
<span><span class="co">#&gt; 2     2       2 response 20.27858 1.2377512 16.383405  2.512745e-60 17.85263  22.70453 21.0   6 100</span></span>
<span><span class="co">#&gt; 3     3       3 response 26.24623 0.9856325 26.628826 3.148430e-156 24.31443  28.17804 22.8   4 100</span></span>
<span><span class="co">#&gt; 4     4       4 response 20.27858 1.2377512 16.383405  2.512745e-60 17.85263  22.70453 21.4   6 100</span></span>
<span><span class="co">#&gt; 5     5       5 response 17.72538 1.8811567  9.422599  4.400597e-21 14.03838  21.41238 18.7   8 100</span></span>
<span><span class="co">#&gt; 6     6       6 response 20.27858 1.2377512 16.383405  2.512745e-60 17.85263  22.70453 18.1   6 100</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 64</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="newdata-and-datagrid">
<code>newdata</code> and <code>datagrid</code><a class="anchor" aria-label="anchor" href="#newdata-and-datagrid"></a>
</h3>
<p>A second strategy to construct grids of predictors for adjusted predictions is to combine the <code>newdata</code> argument and the <code>datagrid</code> function. Recall that this function creates a “typical” dataset with all variables at their means or modes, except those we explicitly define:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span>, model <span class="op">=</span> <span class="va">mod</span><span class="op">)</span></span>
<span><span class="co">#&gt;        mpg       hp cyl</span></span>
<span><span class="co">#&gt; 1 20.09062 146.6875   4</span></span>
<span><span class="co">#&gt; 2 20.09062 146.6875   6</span></span>
<span><span class="co">#&gt; 3 20.09062 146.6875   8</span></span></code></pre></div>
<p>We can also use this <code>datagrid</code> function in a <code>predictions</code> call (omitting the <code>model</code> argument):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rowid     type estimate std.error statistic      p.value conf.low conf.high      mpg       hp cyl</span></span>
<span><span class="co">#&gt; 1     1 response 16.60307  1.278754  12.98379 1.512165e-38 14.09676  19.10938 20.09062 146.6875   8</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rowid     type estimate std.error statistic      p.value conf.low conf.high      mpg       hp cyl</span></span>
<span><span class="co">#&gt; 1     1 response 25.12392  1.368888  18.35353 3.093502e-75 22.44095  27.80689 20.09062 146.6875   4</span></span>
<span><span class="co">#&gt; 2     2 response 19.15627  1.247190  15.35955 3.057119e-53 16.71182  21.60071 20.09062 146.6875   6</span></span>
<span><span class="co">#&gt; 3     3 response 16.60307  1.278754  12.98379 1.512165e-38 14.09676  19.10938 20.09062 146.6875   8</span></span></code></pre></div>
<p>Users can change the summary function used to summarize each type of variables using the <code>FUN_numeric</code>, <code>FUN_factor</code>, and related arguments. For example:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">+</span> <span class="va">drat</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">am</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">m</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>FUN_factor <span class="op">=</span> <span class="va">unique</span>, FUN_numeric <span class="op">=</span> <span class="va">median</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rowid     type estimate std.error statistic      p.value conf.low conf.high  mpg  hp  drat cyl am</span></span>
<span><span class="co">#&gt; 1     1 response 21.95333  1.288065  17.04365 3.896507e-65 19.42877  24.47789 19.2 123 3.695   6  1</span></span>
<span><span class="co">#&gt; 2     2 response 18.18910  1.270927  14.31168 1.849819e-46 15.69813  20.68007 19.2 123 3.695   6  0</span></span>
<span><span class="co">#&gt; 3     3 response 25.54890  1.322154  19.32369 3.395189e-83 22.95752  28.14027 19.2 123 3.695   4  1</span></span>
<span><span class="co">#&gt; 4     4 response 21.78467  1.541301  14.13395 2.346178e-45 18.76377  24.80556 19.2 123 3.695   4  0</span></span>
<span><span class="co">#&gt; 5     5 response 22.61705  2.140950  10.56403 4.374878e-26 18.42087  26.81324 19.2 123 3.695   8  1</span></span>
<span><span class="co">#&gt; 6     6 response 18.85282  1.734026  10.87228 1.562441e-27 15.45419  22.25145 19.2 123 3.695   8  0</span></span></code></pre></div>
<p>The <code>data.frame</code> produced by <code>predictions</code> is “tidy”, which makes it easy to manipulate with other <code>R</code> packages and functions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="va">mtcars</span><span class="op">$</span><span class="va">cyl</span>, hp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">110</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">hp</span>, <span class="va">cyl</span>, <span class="va">estimate</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>values_from <span class="op">=</span> <span class="va">estimate</span>, names_from <span class="op">=</span> <span class="va">cyl</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kbl.html" class="external-link">kbl</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"A table of Adjusted Predictions"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html" class="external-link">add_header_above</a></span><span class="op">(</span>header <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">" "</span> <span class="op">=</span> <span class="fl">1</span>, <span class="st">"cyl"</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<table class="table table" style="margin-left: auto; margin-right: auto;">
<caption>
A table of Adjusted Predictions
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
cyl
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
hp
</th>
<th style="text-align:right;">
6
</th>
<th style="text-align:right;">
4
</th>
<th style="text-align:right;">
8
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
100
</td>
<td style="text-align:right;">
20.27858
</td>
<td style="text-align:right;">
26.24623
</td>
<td style="text-align:right;">
17.72538
</td>
</tr>
<tr>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;">
20.03819
</td>
<td style="text-align:right;">
26.00585
</td>
<td style="text-align:right;">
17.48500
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="counterfactual-data-grid">
<code>counterfactual</code> data grid<a class="anchor" aria-label="anchor" href="#counterfactual-data-grid"></a>
</h3>
<p>An alternative approach to construct grids of predictors is to use <code>grid_type = "counterfactual"</code> argument value. This will duplicate the <em>whole</em> dataset, with the different values specified by the user.</p>
<p>For example, the <code>mtcars</code> dataset has 32 rows. This command produces a new dataset with 64 rows, with each row of the original dataset duplicated with the two values of the <code>am</code> variable supplied (0 and 1):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">vs</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">+</span> <span class="va">am</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">mod</span>, am <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, grid_type <span class="op">=</span> <span class="st">"counterfactual"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">nd</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 64  4</span></span></code></pre></div>
<p>Then, we can use this dataset and the <code>predictions</code> function to create interesting visualizations:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, grid_type <span class="op">=</span> <span class="st">"counterfactual"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">am</span>, <span class="va">estimate</span>, <span class="va">rowidcf</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="va">rowidcf</span>, </span>
<span>                names_from <span class="op">=</span> <span class="va">am</span>,</span>
<span>                values_from <span class="op">=</span> <span class="va">estimate</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pred</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">`0`</span>, y <span class="op">=</span> <span class="va">`1`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Predicted Pr(vs=1), when am = 0"</span>,</span>
<span>         y <span class="op">=</span> <span class="st">"Predicted Pr(vs=1), when am = 1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<p>In this graph, each dot represents the predicted probability that <code>vs=1</code> for one observation of the dataset, in the counterfactual worlds where <code>am</code> is either 0 or 1.</p>
</div>
</div>
<div class="section level2">
<h2 id="adjusted-prediction-at-the-mean-apm">Adjusted Prediction at the Mean (APM)<a class="anchor" aria-label="anchor" href="#adjusted-prediction-at-the-mean-apm"></a>
</h2>
<p>Some analysts may want to calculate an “Adjusted Prediction at the Mean,” that is, the predicted outcome when all the regressors are held at their mean (or mode). To achieve this, we use the <code>datagrid</code> function. By default, this function produces a grid of data with regressors at their means or modes, so all we need to do to get the APM is:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rowid     type   estimate  std.error statistic   p.value    conf.low conf.high     vs       hp      am</span></span>
<span><span class="co">#&gt; 1     1 response 0.06308965 0.08662801 0.7282823 0.4664408 0.003794253  0.543491 0.4375 146.6875 0.40625</span></span></code></pre></div>
<p>This is equivalent to calling:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagrid.html">datagrid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rowid     type   estimate  std.error statistic   p.value    conf.low conf.high     vs       hp      am</span></span>
<span><span class="co">#&gt; 1     1 response 0.06308965 0.08662801 0.7282823 0.4664408 0.003794253  0.543491 0.4375 146.6875 0.40625</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="average-adjusted-predictions-aap">Average Adjusted Predictions (AAP)<a class="anchor" aria-label="anchor" href="#average-adjusted-predictions-aap"></a>
</h2>
<p>An “Average Adjusted Prediction” is the outcome of a two step process:</p>
<ol style="list-style-type: decimal">
<li>Create a new dataset with each of the original regressor values, but fixing some regressors to values of interest.</li>
<li>Take the average of the predicted values in this new dataset.</li>
</ol>
<p>We can obtain AAPs by applying the <code><a href="../reference/averages.html">averages()</a></code> functions to an object produced by the <code><a href="../reference/predictions.html">predictions()</a></code> function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/averages.html">averages</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Estimate Std. Error    z   Pr(&gt;|z|)  2.5 % 97.5 %</span></span>
<span><span class="co">#&gt; 1   0.4375    0.04288 10.2 &lt; 2.22e-16 0.3535 0.5215</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model type:  glm </span></span>
<span><span class="co">#&gt; Prediction type:  response</span></span></code></pre></div>
<p>This is equivalent to:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pred</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.4375</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="average-adjusted-predictions-by-group">Average Adjusted Predictions by Group<a class="anchor" aria-label="anchor" href="#average-adjusted-predictions-by-group"></a>
</h2>
<p>We can compute average adjusted predictions for different subsets of the data with the <code>by</code> argument.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, by <span class="op">=</span> <span class="st">"am"</span><span class="op">)</span></span>
<span><span class="co">#&gt;       type am  estimate  std.error statistic      p.value  conf.low conf.high</span></span>
<span><span class="co">#&gt; 1 response  1 0.5384615 0.08476453  6.352439 2.119271e-10 0.3723261 0.7045970</span></span>
<span><span class="co">#&gt; 2 response  0 0.3684211 0.04303045  8.561868 1.110528e-17 0.2840829 0.4527592</span></span></code></pre></div>
<p>In the next example, we create a “counterfactual” data grid where each observation of the dataset is repeated twice, with different values of the <code>am</code> variable, and all other variables held at the observed values. We also show the equivalent results using <code>dplyr</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"am"</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagridcf.html">datagridcf</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       type am  estimate  std.error statistic      p.value  conf.low conf.high</span></span>
<span><span class="co">#&gt; 1 response  0 0.5261185 0.03302867 15.929147 3.977479e-57 0.4613835 0.5908535</span></span>
<span><span class="co">#&gt; 2 response  1 0.3301815 0.06461896  5.109669 3.227235e-07 0.2035307 0.4568324</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    newdata <span class="op">=</span> <span class="fu"><a href="../reference/datagridcf.html">datagridcf</a></span><span class="op">(</span>am <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">am</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>AAP <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">estimate</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span></span>
<span><span class="co">#&gt;      am   AAP</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0 0.526</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 0.330</span></span></code></pre></div>
<div class="section level3">
<h3 id="multinomial-models">Multinomial models<a class="anchor" aria-label="anchor" href="#multinomial-models"></a>
</h3>
<p>One place where this is particularly useful is in multinomial models with different response levels. For example, here we compute the average predicted outcome for each outcome level in a multinomial logit model. Note that response levels are identified by the “group” column.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">nnet</a></span><span class="op">)</span></span>
<span><span class="va">nom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">multinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">gear</span><span class="op">)</span> <span class="op">~</span> <span class="va">mpg</span> <span class="op">+</span> <span class="va">am</span> <span class="op">*</span> <span class="va">vs</span>, data <span class="op">=</span> <span class="va">mtcars</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># first 5 raw predictions</span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">nom</span>, type <span class="op">=</span> <span class="st">"probs"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rowid  type group     estimate    std.error    statistic    p.value      conf.low    conf.high  mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span><span class="co">#&gt; 1     1 probs     3 3.623918e-05 2.002490e-03   0.01809706 0.98556142 -3.888569e-03 3.961047e-03 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></span>
<span><span class="co">#&gt; 2     2 probs     3 3.623918e-05 2.002490e-03   0.01809706 0.98556142 -3.888569e-03 3.961047e-03 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></span>
<span><span class="co">#&gt; 3     3 probs     3 9.347603e-08 6.911938e-06   0.01352385 0.98920986 -1.345367e-05 1.364063e-05 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></span>
<span><span class="co">#&gt; 4     4 probs     3 4.044657e-01 1.965452e-01   2.05787667 0.03960197  1.924426e-02 7.896871e-01 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></span>
<span><span class="co">#&gt; 5     5 probs     3 9.999714e-01 1.246217e-03 802.40562752 0.00000000  9.975289e-01 1.002414e+00 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></span>
<span><span class="co">#&gt; 6     6 probs     3 5.183336e-01 2.898025e-01   1.78857550 0.07368321 -4.966881e-02 1.086336e+00 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></span>
<span></span>
<span><span class="co"># average predictions</span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">nom</span>, type <span class="op">=</span> <span class="st">"probs"</span>, by <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/averages.html">averages</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Group Estimate Std. Error      z   Pr(&gt;|z|)   2.5 % 97.5 %</span></span>
<span><span class="co">#&gt; 1     3   0.4688    0.04043 11.595 &lt; 2.22e-16 0.38952 0.5480</span></span>
<span><span class="co">#&gt; 2     4   0.3750    0.06142  6.106 1.0231e-09 0.25462 0.4954</span></span>
<span><span class="co">#&gt; 3     5   0.1562    0.04624  3.379  0.0007279 0.06561 0.2469</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model type:  multinom </span></span>
<span><span class="co">#&gt; Prediction type:  probs</span></span></code></pre></div>
<p>We can use custom aggregations by supplying a data frame to the <code>by</code> argument. All columns of this data frame must be present in the output of <code><a href="../reference/predictions.html">predictions()</a></code>, and the data frame must also include a <code>by</code> column of labels. In this example, we “collapse” response groups:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">by</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    group <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"3"</span>, <span class="st">"4"</span>, <span class="st">"5"</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"3,4"</span>, <span class="st">"3,4"</span>, <span class="st">"5"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">nom</span>, type <span class="op">=</span> <span class="st">"probs"</span>, by <span class="op">=</span> <span class="va">by</span><span class="op">)</span></span>
<span><span class="co">#&gt;    type  estimate  std.error statistic      p.value   conf.low conf.high  by</span></span>
<span><span class="co">#&gt; 1 probs 0.4218766 0.02312133 18.246210 2.217708e-74 0.37655960 0.4671935 3,4</span></span>
<span><span class="co">#&gt; 2 probs 0.1562469 0.04624265  3.378848 7.279037e-04 0.06561294 0.2468808   5</span></span></code></pre></div>
<p>This can be very useful in combination with the <code>hypothesis</code> argument. For example, here we compute the difference between average adjusted predictions for the 3 and 4 response levels, compared to the 5 response level:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">nom</span>, type <span class="op">=</span> <span class="st">"probs"</span>, by <span class="op">=</span> <span class="va">by</span>, hypothesis <span class="op">=</span> <span class="st">"sequential"</span><span class="op">)</span></span>
<span><span class="co">#&gt;    type    term   estimate  std.error statistic      p.value   conf.low  conf.high</span></span>
<span><span class="co">#&gt; 1 probs 5 - 3,4 -0.2656297 0.06936398 -3.829505 0.0001284013 -0.4015806 -0.1296788</span></span></code></pre></div>
<p>We can also use more complicated aggregations. Here, we compute the predicted probability of outcome levels for each value of <code>cyl</code>, by collapsing the “3” and “4” outcome levels:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">multinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">gear</span><span class="op">)</span> <span class="op">~</span> <span class="va">mpg</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">cyl</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mtcars</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">by</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>    group <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>    cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>    stringsAsFactors <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="co"># define labels</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span>by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span></span>
<span>        <span class="va">group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">3</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"3/4 Gears &amp; %s Cylinders"</span>, <span class="va">cyl</span><span class="op">)</span>,</span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"5 Gears &amp; %s Cylinders"</span>, <span class="va">cyl</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">nom</span>, by <span class="op">=</span> <span class="va">by</span><span class="op">)</span></span>
<span><span class="co">#&gt;    type  estimate  std.error statistic      p.value    conf.low conf.high                      by</span></span>
<span><span class="co">#&gt; 1 probs 0.4285648 0.06606515  6.487003 8.756078e-11  0.29907950 0.5580501 3/4 Gears &amp; 6 Cylinders</span></span>
<span><span class="co">#&gt; 2 probs 0.4092432 0.05797517  7.058938 1.677800e-12  0.29561390 0.5228724 3/4 Gears &amp; 4 Cylinders</span></span>
<span><span class="co">#&gt; 3 probs 0.4285364 0.04584405  9.347700 8.957431e-21  0.33868374 0.5183891 3/4 Gears &amp; 8 Cylinders</span></span>
<span><span class="co">#&gt; 4 probs 0.1428704 0.13213030  1.081284 2.795709e-01 -0.11610027 0.4018410   5 Gears &amp; 6 Cylinders</span></span>
<span><span class="co">#&gt; 5 probs 0.1815137 0.11595035  1.565443 1.174790e-01 -0.04574482 0.4087722   5 Gears &amp; 4 Cylinders</span></span>
<span><span class="co">#&gt; 6 probs 0.1429271 0.09168810  1.558841 1.190341e-01 -0.03677823 0.3226325   5 Gears &amp; 8 Cylinders</span></span></code></pre></div>
<p>And we can then compare the different groups using the <code>hypothesis</code> argument:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">nom</span>, by <span class="op">=</span> <span class="va">by</span>, hypothesis <span class="op">=</span> <span class="st">"pairwise"</span><span class="op">)</span></span>
<span><span class="co">#&gt;     type                                              term      estimate  std.error     statistic    p.value     conf.low conf.high</span></span>
<span><span class="co">#&gt; 1  probs 3/4 Gears &amp; 6 Cylinders - 3/4 Gears &amp; 4 Cylinders  1.932166e-02 0.08789439  0.2198281561 0.82600499 -0.152948169 0.1915915</span></span>
<span><span class="co">#&gt; 2  probs 3/4 Gears &amp; 6 Cylinders - 3/4 Gears &amp; 8 Cylinders  2.839251e-05 0.08041288  0.0003530841 0.99971828 -0.157577948 0.1576347</span></span>
<span><span class="co">#&gt; 3  probs   3/4 Gears &amp; 6 Cylinders - 5 Gears &amp; 6 Cylinders  2.856945e-01 0.19819546  1.4414783343 0.14944959 -0.102761500 0.6741504</span></span>
<span><span class="co">#&gt; 4  probs   3/4 Gears &amp; 6 Cylinders - 5 Gears &amp; 4 Cylinders  2.470511e-01 0.13345296  1.8512226242 0.06413753 -0.014511856 0.5086141</span></span>
<span><span class="co">#&gt; 5  probs   3/4 Gears &amp; 6 Cylinders - 5 Gears &amp; 8 Cylinders  2.856377e-01 0.11301068  2.5275281722 0.01148686  0.064140813 0.5071345</span></span>
<span><span class="co">#&gt; 6  probs 3/4 Gears &amp; 4 Cylinders - 3/4 Gears &amp; 8 Cylinders -1.929327e-02 0.07390977 -0.2610381284 0.79406310 -0.164153757 0.1255672</span></span>
<span><span class="co">#&gt; 7  probs   3/4 Gears &amp; 4 Cylinders - 5 Gears &amp; 6 Cylinders  2.663728e-01 0.14429187  1.8460693876 0.06488213 -0.016434064 0.5491797</span></span>
<span><span class="co">#&gt; 8  probs   3/4 Gears &amp; 4 Cylinders - 5 Gears &amp; 4 Cylinders  2.277295e-01 0.17392552  1.3093505208 0.19041564 -0.113158287 0.5686172</span></span>
<span><span class="co">#&gt; 9  probs   3/4 Gears &amp; 4 Cylinders - 5 Gears &amp; 8 Cylinders  2.663160e-01 0.10848095  2.4549565672 0.01409016  0.053697263 0.4789348</span></span>
<span><span class="co">#&gt; 10 probs   3/4 Gears &amp; 8 Cylinders - 5 Gears &amp; 6 Cylinders  2.856661e-01 0.13985777  2.0425469855 0.04109730  0.011549874 0.5597823</span></span>
<span><span class="co">#&gt; 11 probs   3/4 Gears &amp; 8 Cylinders - 5 Gears &amp; 4 Cylinders  2.470227e-01 0.12468539  1.9811682440 0.04757241  0.002643861 0.4914016</span></span>
<span><span class="co">#&gt; 12 probs   3/4 Gears &amp; 8 Cylinders - 5 Gears &amp; 8 Cylinders  2.856093e-01 0.13753215  2.0766728278 0.03783177  0.016051218 0.5551673</span></span>
<span><span class="co">#&gt; 13 probs     5 Gears &amp; 6 Cylinders - 5 Gears &amp; 4 Cylinders -3.864332e-02 0.17578877 -0.2198281561 0.82600499 -0.383182981 0.3058963</span></span>
<span><span class="co">#&gt; 14 probs     5 Gears &amp; 6 Cylinders - 5 Gears &amp; 8 Cylinders -5.678502e-05 0.16082575 -0.0003530841 0.99971828 -0.315269466 0.3151559</span></span>
<span><span class="co">#&gt; 15 probs     5 Gears &amp; 4 Cylinders - 5 Gears &amp; 8 Cylinders  3.858654e-02 0.14781954  0.2610381284 0.79406310 -0.251134441 0.3283075</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="bayesian-models">Bayesian models<a class="anchor" aria-label="anchor" href="#bayesian-models"></a>
</h3>
<p>The same strategy works for bayesian models:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span><span class="va">am</span> <span class="op">~</span> <span class="va">mpg</span> <span class="op">*</span> <span class="va">vs</span>, data <span class="op">=</span> <span class="va">mtcars</span>, family <span class="op">=</span> <span class="va">bernoulli</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, by <span class="op">=</span> <span class="st">"vs"</span><span class="op">)</span></span>
<span><span class="co">#&gt;       type vs  estimate  conf.low conf.high</span></span>
<span><span class="co">#&gt; 1 response  0 0.3271836 0.1824479 0.5072074</span></span>
<span><span class="co">#&gt; 2 response  1 0.4993250 0.3657956 0.6721267</span></span></code></pre></div>
<p>The results above show the median of the posterior distribution of group-wise means. Note that we take the mean of predicted values for each MCMC draw before computing quantiles. This is equivalent to:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstantools/reference/posterior_epred.html" class="external-link">posterior_epred</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">draws</span><span class="op">[</span>, <span class="va">mtcars</span><span class="op">$</span><span class="va">vs</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.025</span>, <span class="fl">.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       50%      2.5%     97.5% </span></span>
<span><span class="co">#&gt; 0.3271836 0.1824479 0.5072074</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">draws</span><span class="op">[</span>, <span class="va">mtcars</span><span class="op">$</span><span class="va">vs</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.025</span>, <span class="fl">.975</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       50%      2.5%     97.5% </span></span>
<span><span class="co">#&gt; 0.4993250 0.3657956 0.6721267</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="conditional-adjusted-predictions-plot">Conditional Adjusted Predictions (Plot)<a class="anchor" aria-label="anchor" href="#conditional-adjusted-predictions-plot"></a>
</h2>
<p>First, we download the <code>ggplot2movies</code> dataset from the <a href="https://vincentarelbundock.github.io/Rdatasets/articles/data.html" class="external-link">RDatasets archive</a>. Then, we create a variable called <code>certified_fresh</code> for movies with a rating of at least 8. Finally, we discard some outliers and fit a logistic regression model:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="st">"https://vincentarelbundock.github.io/Rdatasets/csv/ggplot2movies/movies.csv"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>style <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span><span class="va">Action</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Action"</span>,</span>
<span>                             <span class="va">Comedy</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Comedy"</span>,</span>
<span>                             <span class="va">Drama</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"Drama"</span>,</span>
<span>                             <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"Other"</span><span class="op">)</span>,</span>
<span>           style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">style</span><span class="op">)</span>,</span>
<span>           certified_fresh <span class="op">=</span> <span class="va">rating</span> <span class="op">&gt;=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">length</span> <span class="op">&lt;</span> <span class="fl">240</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">certified_fresh</span> <span class="op">~</span> <span class="va">length</span> <span class="op">*</span> <span class="va">style</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code></pre></div>
<p>We can plot adjusted predictions, conditional on the <code>length</code> variable using the <code>plot_cap</code> function:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">certified_fresh</span> <span class="op">~</span> <span class="va">length</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_cap.html">plot_cap</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"length"</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-26-1.png" width="576"></p>
<p>We can also introduce another condition which will display a categorical variable like <code>style</code> in different colors. This can be useful in models with interactions:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">certified_fresh</span> <span class="op">~</span> <span class="va">length</span> <span class="op">*</span> <span class="va">style</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_cap.html">plot_cap</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"length"</span>, <span class="st">"style"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-27-1.png" width="576"></p>
<p>Since the output of <code><a href="../reference/plot_cap.html">plot_cap()</a></code> is a <code>ggplot2</code> object, it is very easy to customize. For example, we can add points for the actual observations of our dataset like so:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel" class="external-link">ggrepel</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mt</span> <span class="op">&lt;-</span> <span class="va">mtcars</span></span>
<span><span class="va">mt</span><span class="op">$</span><span class="va">label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">mt</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span>, data <span class="op">=</span> <span class="va">mt</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/plot_cap.html">plot_cap</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"hp"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mt</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">mt</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">mt</span>, <span class="va">hp</span> <span class="op">&gt;</span> <span class="fl">250</span><span class="op">)</span>,</span>
<span>                    nudge_y <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-28-1.png" width="576"></p>
<p>We can also use <code><a href="../reference/plot_cap.html">plot_cap()</a></code> in models with multinomial outcomes or grouped coefficients. For example, notice that when we call <code>draw=FALSE</code>, the result includes a <code>group</code> column:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu">nnet</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nnet/man/multinom.html" class="external-link">multinom</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">gear</span><span class="op">)</span> <span class="op">~</span> <span class="va">mpg</span>, data <span class="op">=</span> <span class="va">mtcars</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_cap.html">plot_cap</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"probs"</span>,</span>
<span>    condition <span class="op">=</span> <span class="st">"mpg"</span>,</span>
<span>    draw <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rowid  type group  estimate  std.error statistic       p.value  conf.low conf.high gear condition1</span></span>
<span><span class="co">#&gt; 1     1 probs     3 0.9714990 0.03871641 25.092693 5.976078e-139 0.8956163  1.047382    3   10.40000</span></span>
<span><span class="co">#&gt; 2     2 probs     3 0.9583559 0.04985914 19.221268  2.456932e-82 0.8606338  1.056078    3   11.37917</span></span>
<span><span class="co">#&gt; 3     3 probs     3 0.9393514 0.06291986 14.929330  2.123901e-50 0.8160307  1.062672    3   12.35833</span></span>
<span><span class="co">#&gt; 4     4 probs     3 0.9122105 0.07727155 11.805256  3.666725e-32 0.7607610  1.063660    3   13.33750</span></span>
<span><span class="co">#&gt; 5     5 probs     3 0.8741884 0.09157738  9.545900  1.349314e-21 0.6947001  1.053677    3   14.31667</span></span>
<span><span class="co">#&gt; 6     6 probs     3 0.8224163 0.10383644  7.920305  2.369279e-15 0.6189006  1.025932    3   15.29583</span></span></code></pre></div>
<p>Now we use the <code>group</code> column:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_cap.html">plot_cap</a></span><span class="op">(</span></span>
<span>    <span class="va">mod</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"probs"</span>,</span>
<span>    condition <span class="op">=</span> <span class="st">"mpg"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">group</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-30-1.png" width="576"></p>
</div>
<div class="section level2">
<h2 id="prediction-types">Prediction types<a class="anchor" aria-label="anchor" href="#prediction-types"></a>
</h2>
<p>The <code>predictions</code> function computes model-adjusted means on the scale of the output of the <code>predict(model)</code> function. By default, <code>predict</code> produces predictions on the <code>"response"</code> scale, so the adjusted predictions should be interpreted on that scale. However, users can pass a string to the <code>type</code> argument, and <code>predictions</code> will consider different outcomes.</p>
<p>Typical values include <code>"response"</code> and <code>"link"</code>, but users should refer to the documentation of the <code>predict</code> of the package they used to fit the model to know what values are allowable. documentation.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">am</span> <span class="op">~</span> <span class="va">mpg</span>, family <span class="op">=</span> <span class="va">binomial</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rowid     type  estimate  std.error statistic      p.value  conf.low conf.high  mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span><span class="co">#&gt; 1     1 response 0.4610951 0.11584004  3.980447 6.878584e-05 0.2554723 0.6808686 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></span>
<span><span class="co">#&gt; 2     2 response 0.4610951 0.11584004  3.980447 6.878584e-05 0.2554723 0.6808686 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></span>
<span><span class="co">#&gt; 3     3 response 0.5978984 0.13239819  4.515911 6.304522e-06 0.3356711 0.8139794 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></span>
<span><span class="co">#&gt; 4     4 response 0.4917199 0.11961263  4.110936 3.940579e-05 0.2746560 0.7119512 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></span>
<span><span class="co">#&gt; 5     5 response 0.2969009 0.10051954  2.953663 3.140264e-03 0.1411369 0.5204086 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></span>
<span><span class="co">#&gt; 6     6 response 0.2599331 0.09782666  2.657078 7.882118e-03 0.1147580 0.4876032 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></span>
<span></span>
<span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictions.html">predictions</a></span><span class="op">(</span><span class="va">mod</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rowid type    estimate std.error   statistic    p.value   conf.low   conf.high  mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></span>
<span><span class="co">#&gt; 1     1 link -0.15593472 0.4661826 -0.33449281 0.73800772 -1.0696358  0.75776637 21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></span>
<span><span class="co">#&gt; 2     2 link -0.15593472 0.4661826 -0.33449281 0.73800772 -1.0696358  0.75776637 21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></span>
<span><span class="co">#&gt; 3     3 link  0.39671602 0.5507048  0.72037875 0.47129183 -0.6826455  1.47607755 22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></span>
<span><span class="co">#&gt; 4     4 link -0.03312345 0.4785818 -0.06921168 0.94482113 -0.9711265  0.90487956 21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></span>
<span><span class="co">#&gt; 5     5 link -0.86209956 0.4815290 -1.79033775 0.07339963 -1.8058791  0.08167995 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></span>
<span><span class="co">#&gt; 6     6 link -1.04631647 0.5085395 -2.05749308 0.03963882 -2.0430356 -0.04959739 18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></span></code></pre></div>
<p>We can also plot predictions on different outcome scales:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_cap.html">plot_cap</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"mpg"</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-32-1.png" width="576"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_cap.html">plot_cap</a></span><span class="op">(</span><span class="va">mod</span>, condition <span class="op">=</span> <span class="st">"mpg"</span>, type <span class="op">=</span> <span class="st">"link"</span><span class="op">)</span></span></code></pre></div>
<p><img src="predictions_files/figure-html/unnamed-chunk-33-1.png" width="576"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Vincent Arel-Bundock.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
